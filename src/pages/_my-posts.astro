---
import { getAllPosts, getPageInfo } from "@lib/wp";
import Layout from "@layouts/Layout.astro";
import Banner from "@components/banner/Banner.astro";
import AllPosts from "@components/posts/AllPosts.astro";

const { title, content, featuredImage } = await getPageInfo("my-posts");

const page = Number(Astro.url.searchParams.get("page")) || 1;
const perPage = Number(Astro.url.searchParams.get("perPage")) || 3;

const { posts, totalPages } = await getAllPosts({ page, perPage });

const prevPage = page > 1 ? page - 1 : null;
const nextPage = page < totalPages ? page + 1 : null;
---

<Layout title={title}>
  <Banner
    title={title}
    content={content}
    featuredImage={featuredImage}
    pageName="my-posts"
  />

  <AllPosts posts={posts} />

  <nav class="flex justify-center gap-4 mt-6">
    {
      prevPage && (
        <a
          href={`/my-posts?page=${prevPage}&perPage=${perPage}`}
          class="px-4 py-2 rounded bg-base shadow hover:bg-primary-dark"
        >
          ← Previous
        </a>
      )
    }
    <span class="px-4 py-2">
      Page {page} of {totalPages}
    </span>
    {
      nextPage && (
        <a
          href={`/my-posts?page=${nextPage}&perPage=${perPage}`}
          class="px-4 py-2 rounded bg-base shadow hover:bg-primary-dark"
        >
          Next →
        </a>
      )
    }
  </nav>
</Layout>
